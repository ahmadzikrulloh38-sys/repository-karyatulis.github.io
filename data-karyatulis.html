<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data Karya Tulis | Repository SMKS 1 Barunawati</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
:root {
  --primary: #4B6CB7;
  --secondary: #FFFFFF;
  --text: #2C2C2C;
  --accent: #00BFFF;
  --shadow: rgba(0,0,0,0.08);
}

* { box-sizing: border-box; font-family: 'Poppins', sans-serif; margin:0; padding:0; }
body { background:#f4f6f9; margin:0; color: var(--text); }

header {
  background: var(--primary);
  color: var(--secondary);
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}
header h1 { font-size: 18px; }
header .user { font-size: 12px; margin-top: 5px; }

.hamburger { display: none; flex-direction: column; cursor: pointer; }
.hamburger span { height:3px; width:25px; background: var(--secondary); margin:4px 0; border-radius:2px; transition:0.3s; }

.container { display:flex; min-height:calc(100vh - 60px); }

.sidebar {
  width: 230px;
  background: var(--primary);
  color: var(--secondary);
  padding-top: 20px;
  flex-shrink:0;
  transition: transform 0.3s ease;
}
.sidebar a { display:block; padding:12px 25px; color:var(--secondary); text-decoration:none; font-size:14px; transition:0.3s; }
.sidebar a:hover, .sidebar a.active { background: var(--accent); color: var(--secondary); }

.content { flex:1; padding:20px; min-width:0; }

.filter-container { display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px; }
.filter-container label { margin-right:5px; font-weight:500; }
select { padding:6px 8px; border-radius:6px; border:1px solid #ccc; outline:none; }
select:focus { border-color: var(--primary); box-shadow:0 0 5px rgba(75,108,183,0.3); }

.table-container { background: var(--secondary); padding:15px; border-radius:12px; box-shadow:0 6px 15px var(--shadow); overflow-x:auto; }
table { width:100%; border-collapse: collapse; font-size:13px; min-width:500px; }
table th, table td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
table th { background: #f0f3f7; font-weight:600; }
tbody tr:hover { background:#f0f4f7; }
td a { color: var(--accent); font-size:18px; display:flex; justify-content:center; align-items:center; }
td:last-child { text-align:center; }

.footer { margin-top:20px; text-align:center; font-size:11px; color:#888; }

/* Responsive */
@media(max-width:768px){
  .sidebar { position:fixed; top:0; left:0; height:100%; transform:translateX(-100%); z-index:1000; }
  .sidebar.active { transform:translateX(0); }
  .hamburger { display:flex; }
  .container { flex-direction:column; }
  .content { padding:15px; }
  table th, table td { padding:8px; font-size:12px; }
}
</style>
</head>

<body>

<header>
  <h1>Repository Karya Tulis SMKS 1 Barunawati</h1>
  <div class="user">Login sebagai: <strong id="namaUser"></strong></div>
  <div class="hamburger" onclick="toggleSidebar()">
    <span></span><span></span><span></span>
  </div>
</header>

<div class="container">
  <nav class="sidebar" id="sidebar">
    <a href="dashboard.html">Dashboard</a>
    <a href="data-karyatulis.html" class="active">Data Karya Tulis</a>
    <a href="upload-karyatulis.html">Upload Karya Tulis</a>
    <a href="#" onclick="logout()">Logout</a>
  </nav>

  <main class="content">
    <h3>Daftar Karya Tulis Siswa</h3>

    <div class="filter-container">
      <div>
        <label for="filterJurusan">Jurusan:</label>
        <select id="filterJurusan"><option value="">Semua Jurusan</option></select>
      </div>
      <div>
        <label for="filterTahun">Tahun:</label>
        <select id="filterTahun"><option value="">Semua Tahun</option></select>
      </div>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr><th>Judul</th><th>Nama</th><th>Jurusan</th><th>Tahun</th><th>Download</th></tr>
        </thead>
        <tbody id="dataTabel">
          <tr><td colspan="5">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="footer">Â© 2025 Repository Karya Tulis | SMKS 1 Barunawati</div>
  </main>
</div>

<script>
// Cek login
if(!localStorage.getItem("login")){
  window.location.href="index.html";
}

// Tampilkan nama user
document.getElementById("namaUser").textContent = localStorage.getItem("nama") || "User";

// Sidebar toggle
function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("active"); }
function logout(){ localStorage.clear(); window.location.href="index.html"; }

let allData = [];

// Render tabel
function renderTable(data){
  const tbody = document.getElementById("dataTabel");
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML = "<tr><td colspan='5'>Data tidak ditemukan</td></tr>";
    return;
  }
  data.forEach(row=>{
    let link = row.link;
    if(link.includes("drive.google.com")){
      const id = link.split("/d/")[1]?.split("/")[0];
      if(id) link = `https://drive.google.com/uc?id=${id}&export=download`;
    }
    tbody.innerHTML += `
      <tr>
        <td>${row.judul}</td>
        <td>${row.nama}</td>
        <td>${row.jurusan}</td>
        <td>${row.tahun}</td>
        <td style="text-align:center"><a href="${link}" target="_blank"><i class="fa-solid fa-download"></i></a></td>
      </tr>`;
  });
}

// Populate filter
function populateFilters(data){
  const jurusanSet = new Set();
  const tahunSet = new Set();
  data.forEach(r => { jurusanSet.add(r.jurusan); tahunSet.add(r.tahun); });
  
  const jurusanSelect = document.getElementById("filterJurusan");
  const tahunSelect = document.getElementById("filterTahun");
  
  jurusanSet.forEach(j => {
    const o = document.createElement("option");
    o.value = j; o.text = j;
    jurusanSelect.appendChild(o);
  });
  tahunSet.forEach(t => {
    const o = document.createElement("option");
    o.value = t; o.text = t;
    tahunSelect.appendChild(o);
  });
}

// Filter event
document.getElementById("filterJurusan").addEventListener("change", applyFilter);
document.getElementById("filterTahun").addEventListener("change", applyFilter);
function applyFilter(){
  const jurusan = document.getElementById("filterJurusan").value;
  const tahun = document.getElementById("filterTahun").value;
  let filtered = allData;
  if(jurusan) filtered = filtered.filter(r => r.jurusan === jurusan);
  if(tahun) filtered = filtered.filter(r => r.tahun === tahun);
  renderTable(filtered);
}

// Fetch data dari Apps Script (ganti dengan URL publik Anda)
const scriptURL = "https://script.google.com/macros/s/AKfycbwhQOV4axjkdQF4tJAFpvzQ4kUpLNoHEIYR2b5pXy8WJsTHGK8jOlRkQcACpBmxylTY/exec";

fetch(scriptURL)
.then(res => res.json())
.then(data => {
  allData = data;
  populateFilters(allData);
  renderTable(allData);
})
.catch(err => {
  console.error(err);
  document.getElementById("dataTabel").innerHTML = "<tr><td colspan='5'>Gagal memuat data</td></tr>";
});
</script>

</body>
</html>
